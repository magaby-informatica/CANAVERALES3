<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formato con Encabezado y Pie de Página Fijos</title>
    <!-- Cargamos Tailwind CSS para estilizar el contenedor en pantalla -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Fuentes básicas */
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
        }

        /*
         * ESTILOS PARA LA IMPRESIÓN
         */
        @media print {
            
            /* Sugerimos al navegador usar tamaño CARTA */
            @page {
                size: letter;
            }

            /* Oculta elementos que no queremos imprimir, como el contenedor de la página en sí */
            body {
                background-color: #fff; /* Fondo blanco para impresión */
            }
            
            .no-imprimir {
                display: none;
            }

            /* Resetea márgenes del navegador en la impresión */
            body {
                margin: 0;
                padding: 0;
            }

            /* --- 1. Reglas del Encabezado --- */
            header.encabezado-impresion {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                width: 100%;
                
                /* TAMAÑO 12pt */
                font-size: 12pt; 
                
                /* Estilos visuales */
                padding: 5mm 10mm;
                border-bottom: 1px solid #ccc;
                background-color: #fff;
                
                /* Altura fija */
                height: 80pt; 
                box-sizing: border-box; 
            }

            /* --- 2. Reglas del Pie de Página --- */
            footer.pie-impresion {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
                
                /* TAMAÑO 10pt */
                font-size: 10pt;

                /* Estilos visuales */
                padding: 5mm 10mm;
                border-top: 1px solid #ccc;
                background-color: #fff;
                text-align: left;

                /* Altura fija */
                height: 60pt; 
                box-sizing: border-box;
            }

            /* --- 3. Reglas del Contenido Principal --- */
            main.cuerpo-impresion {
                /* TAMAÑO 12pt */
                font-size: 12pt;
                
                /* Relleno para no chocar con header/footer */
                padding-top: 80pt;
                padding-bottom: 60pt;
                
                /* Márgenes de la hoja */
                margin-left: 10mm;
                margin-right: 10mm;
            }
            
            /* Ocultamos el 'contenedor-pagina' que solo es para la vista en pantalla */
            .contenedor-pagina-pantalla {
                border: none;
                box-shadow: none;
                margin: 0;
                max-width: none;
            }

            /* Evita que los títulos se corten */
            h1, h2, h3 {
                page-break-after: avoid;
            }
        }
        
        /* * ESTILOS DE PANTALLA (NO IMPRESIÓN)
         * Esto es solo para que se vea bien en el navegador.
         */
        .contenedor-pagina-pantalla {
            max-width: 800px;
            margin: 2rem auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            overflow: hidden; /* para los bordes redondeados */
            background: white;
        }
        
        /*
         * Clases de Tailwind que usaremos en el HTML.
         * Las re-declaramos aquí para que el HTML sea más limpio
         * y para que funcionen aunque Tailwind no cargue.
        */
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-start { align-items: flex-start; }
        .w-1\/3 { width: 33.33%; }
        .w-2\/3 { width: 66.66%; }
        .text-right { text-align: right; }
        .mt-2 { margin-top: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .p-4 { padding: 1rem; }
        .border-b { border-bottom: 1px solid #eee; }
        .border-t { border-top: 1px solid #eee; }
        .font-bold { font-weight: bold; }
        .space-x-4 > * + * { margin-left: 1rem; }
        .text-left { text-align: left; }
        .w-28 { width: 7rem; }
        .h-28 { height: 7rem; }
        .border-2 { border-width: 2px; }
        .border-dashed { border-style: dashed; }
        .border-gray-400 { border-color: #9CA3AF; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .text-gray-500 { color: #6B7280; }
        .text-sm { font-size: 0.875rem; }
        .font-sans { font-family: sans-serif; }
        .img-placeholder {
            width: 112px; height: 112px; border: 2px dashed #aaa;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: #777;
        }
        .img-fluida {
            max-width: 112px; max-height: 112px;
            width: auto; height: auto;
        }
    </style>
</head>
<!-- 
  AÑADIMOS EL SCRIPT DE "AUTORELLENO" Y "AUTOIMPRESIÓN" 
  Este es el código "inteligente" que lee la URL.
-->
<body onload="llenarYImprimir()" class="bg-gray-100">

    <!-- 
      Este es el contenedor que verás en PANTALLA.
      Los estilos de @media print se aplicarán a los elementos internos.
    -->
    <div class="contenedor-pagina-pantalla">

        <!-- ===== ENCABEZADO ===== -->
        <header class="encabezado-impresion p-4 border-b">
            <div class="flex justify-between items-start">
                <!-- Columna Izquierda: Imagen Placeholder -->
                <div class="w-1/3">
                    <!-- Este div será reemplazado por la imagen real -->
                    <div id="imagen-placeholder" class="img-placeholder">
                        &lt;&lt;[IMAGE-R]&gt;&gt;
                    </div>
                </div>
                <!-- Columna Derecha: Radicados -->
                <div class="w-2/3 text-right" style="font-size: 12pt;">
                    <p><strong>RADICADO P.:</strong> <span id="radicado_p">&lt;&lt;[RADICADOR]&gt;&gt;</span></p>
                    <p><strong>RADICADO RESP.:</strong> <span id="radicado_rep">&lt;&lt;[RADICADO.REP]&gt;&gt;</span></p>
                    <p><strong>FECHA.:</strong> <span id="fecha">&lt;&lt;[FECHA]&gt;&gt;</span></p>
                </div>
            </div>
        </header>

        <!-- ===== CUERPO DEL DOCUMENTO ===== -->
        <main class="cuerpo-impresion p-4">
            <p class="mb-6"><strong>ASUNTO:</strong> <span id="asunto">&lt;&lt;[ASUNTO]&gt;&gt;</span></p>
            
            <!-- Esta es la sección de respuesta principal -->
            <div style="text-align: justify;">
                <!-- El contenido de la respuesta se insertará aquí -->
                <div id="respuesta" class="mb-4">
                    <p>&lt;&lt;[RESPUESTA]&gt;&gt;</p>
                </div>
            </div>
        </main>

        <!-- ===== PIE DE PÁGINA ===== -->
        <footer class="pie-impresion p-4 border-t" style="font-size: 10pt;">
            <div class="flex justify-between text-left space-x-4">
                <!-- Columna 1: Teléfonos -->
                <div class="w-1/3">
                    <h4 class="font-bold">Teléfonos de Contactos</h4>
                    <p>OFICINA: 324-3371948</p>
                    <p>PORTERÍA: 304-4171456</p>
                    <p>FIJO PORTERÍA: 602-3904447</p>
                </div>
                <!-- Columna 2: Correo -->
                <div class="w-1/3">
                    <h4 class="font-bold">Correo electrónico</h4>
                    <p>gdicanaverales3@gmail.com</p>
                </div>
                <!-- Columna 3: Dirección -->
                <div class="w-1/3">
                    <h4 class="font-bold">Dirección</h4>
                    <p>CR 61 # 18 - 16, Cali, Colombia</p>
                </div>
            </div>
        </footer>

    </div>

    <!-- 
      ESTE ES EL JAVASCRIPT "INTELIGENTE"
      Lee los parámetros de la URL y llena el documento.
    -->
    <script>
        function llenarYImprimir() {
            try {
                // 1. Crear un objeto para leer los parámetros de la URL
                const params = new URLSearchParams(window.location.search);

                // 2. Función para obtener un parámetro y escribirlo en el HTML
                // (Decodifica el texto de la URL)
                function actualizarCampo(id, parametro) {
                    const valor = params.get(parametro);
                    if (valor) {
                        // Usamos innerHTML para que respete los saltos de línea (si los hubiera)
                        document.getElementById(id).innerHTML = decodeURIComponent(valor);
                    }
                }

                // 3. Llenar todos los campos de texto
                actualizarCampo('radicado_p', 'radicado_p');
                actualizarCampo('radicado_rep', 'radicado_rep');
                actualizarCampo('fecha', 'fecha');
                actualizarCampo('asunto', 'asunto');
                
                // 4. Llenar la respuesta (maneja saltos de línea)
                const respuesta = params.get('respuesta');
                if (respuesta) {
                    // Reemplazamos \n (salto de línea) con <br> para que se vea en HTML
                    const respuestaHtml = decodeURIComponent(respuesta).replace(/\n/g, '<br>');
                    document.getElementById('respuesta').innerHTML = respuestaHtml;
                }

                // 5. Manejar la imagen
                const imagenUrl = params.get('imagen');
                if (imagenUrl) {
                    const urlDecodificada = decodeURIComponent(imagenUrl);
                    const contenedorImagen = document.getElementById('imagen-placeholder');
                    // Reemplazamos el div del placeholder con una etiqueta <img>
                    contenedorImagen.innerHTML = `<img src="${urlDecodificada}" alt="Imagen de AppSheet" class="img-fluida">`;
                }

                // 6. Finalmente, llamar a la impresión
                // Usamos un pequeño retraso para asegurar que la imagen (si existe) 
                // tenga tiempo de empezar a cargarse.
                setTimeout(() => {
                    window.print();
                }, 500); // 0.5 segundos de espera

            } catch (e) {
                console.error("Error al llenar los datos:", e);
                // Si algo falla, al menos intenta imprimir
                window.print();
            }
        }
    </script>

</body>
</html>

